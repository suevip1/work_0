<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dtstack.engine.dao.AlertTriggerRecordReceiveDao">
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Mon May 09 06:42:23 UTC 2022.
        -->
        `id`, `alert_trigger_record_id`, `receive_user_id`, `receive_user_name`, `gmt_create`,
        `gmt_modified`, `is_deleted`
    </sql>

    <insert id="batchInsert">
        insert into alert_trigger_record_receive (  `alert_trigger_record_id`, `receive_user_id`,
        `receive_user_name`, `is_deleted`)
        values
        <foreach collection="alertTriggerRecordReceives" item="alertTriggerRecordReceive" separator=",">
            (#{alertTriggerRecordReceive.alertTriggerRecordId},
            #{alertTriggerRecordReceive.receiveUserId},
            #{alertTriggerRecordReceive.receiveUserName},
            #{alertTriggerRecordReceive.isDeleted})
        </foreach>
    </insert>



    <select id="selectCountByReceiverId" resultType="java.lang.Integer">
        SELECT count(1)
        FROM alert_trigger_record_receive rr
                 left join alert_trigger_record atr on rr.alert_trigger_record_id = atr.id
        WHERE `receive_user_id` = #{receiverId}
          AND rr.`is_deleted` = 0
          AND atr.`is_deleted` = 0
          AND atr.app_type = #{appType}
          AND rr.`gmt_create` &gt;= #{gmtCreate}
          AND atr.project_id = #{projectId}
    </select>

    <select id="selectRecordNameByReceiverIds"
            resultType="com.dtstack.engine.po.AlertTriggerRecordReceive">
        SELECT
        `alert_trigger_record_id`,`receive_user_id`,`receive_user_name`
        FROM `alert_trigger_record_receive`
        WHERE `alert_trigger_record_id` IN
        <foreach collection="ids" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>
        AND `is_deleted` = 0
    </select>

    <select id="selectRecordUserIdByReceiverIds"
            resultType="com.dtstack.engine.po.AlertTriggerRecordReceive">
        SELECT
            `receive_user_id`,project_id,app_type
        FROM `alert_trigger_record_receive` atrr
                 left join `alert_trigger_record` atr
                           on atrr.alert_trigger_record_id = atr.id
        WHERE   atrr.gmt_create  &gt;= #{gmtCreate}
          AND atrr.`is_deleted` = 0
    </select>


</mapper>