package com.dtstack.engine.master.mockcontainer.impl;

import com.alibaba.fastjson.JSONObject;
import com.alibaba.testable.core.annotation.MockInvoke;
import com.dtstack.engine.api.domain.ScheduleJob;
import com.dtstack.engine.common.enums.EDeployMode;
import com.dtstack.engine.dao.ScheduleTaskShadeDao;
import com.dtstack.engine.master.impl.ClusterService;
import com.dtstack.engine.master.impl.ScheduleDictService;
import com.dtstack.engine.master.impl.ScheduleJobService;
import com.dtstack.engine.master.impl.TaskParamsService;
import org.apache.ibatis.annotations.Param;

import java.util.Map;

public class PluginWrapperMock {

    @MockInvoke(targetClass = TaskParamsService.class)
    public EDeployMode parseDeployTypeByTaskParams(String taskParams, Integer computeType, String engineType, Long tenantId) {
        return EDeployMode.SESSION;
    }

    @MockInvoke(targetClass = ScheduleDictService.class)
    public String convertVersionNameToValue(String componentVersion, String engineType) {
        return "1.12";
    }

    @MockInvoke(targetClass = ClusterService.class)
    public JSONObject pluginInfoJSON(Long projectId, Integer appType, Integer taskType, Long dtUicTenantId, String engineTypeStr, Long dtUicUserId, Integer deployMode, Long resourceId, Map<Integer, String> componentVersionMap) {
        if ("flink".equalsIgnoreCase(engineTypeStr)) {
            return JSONObject.parseObject("{\"cluster\":\"default\",\"prometheusHost\":\"172.16.23.25\",\"metrics.reporter.promgateway.port\":\"9090\",\"yarnAccepterTaskNumber\":\"3\",\"restart-strategy.failure-rate.max-failures-per-interval\":\"2\",\"env.java.opts\":\"-XX:+UseConcMarkSweepGC -XX:+CMSParallelRemarkEnabled -XX:+CMSIncrementalMode -XX:+CMSIncrementalPacing -XX:MaxMetaspaceSize=500m -Dfile.encoding=UTF-8\",\"flinkLibDir\":\"/data/112_flinkplugin/lib/\",\"metrics.reporter.promgateway.jobName\":\"112job\",\"high-availability.zookeeper.path.root\":\"/flink112\",\"checkpoint.retain.time\":\"7\",\"metrics.reporter.promgateway.class\":\"org.apache.flink.metrics.prometheus.PrometheusPushGatewayReporter\",\"high-availability.storageDir\":\"hdfs://ns1/dtInsight/flink112/ha\",\"restart-strategy.failure-rate.failure-rate-interval\":\"1 min\",\"pluginLoadMode\":\"shipfile\",\"taskmanager.memory.process.size\":\"2048m\",\"deployMode\":1,\"hadoopConf\":{\"yarn.resourcemanager.zk-address\":\"172.16.21.107:2181,172.16.22.103:2181,172.16.23.238:2181\",\"yarn.scheduler.capacity.root.acl_submit_applications\":\"*\",\"mapred.child.java.opts\":\"-agentpath:/usr/lib/hadoop/bin/libagent.so -Xmx2048m\",\"dfs.replication\":\"3\",\"yarn.admin.acl\":\"*\",\"dfs.ha.fencing.ssh.private-key-files\":\"~/.ssh/id_rsa\",\"yarn.app.mapreduce.am.job.committer.cancel-timeout\":\"60000\",\"httpfs.hadoop.authentication.kerberos.keytab\":\"/etc/hdfs1/conf/hdfs.keytab\",\"dfs.ha.namenodes.ns1\":\"nn1,nn2\",\"yarn.resourcemanager.address.rm1\":\"172.16.21.107:8032\",\"httpfs.authentication.kerberos.principal\":\"HTTP/tdh-621-node01@TDH\",\"dfs.namenode.avoid.read.stale.datanode\":\"FALSE\",\"dfs.journalnode.rpc-address\":\"0.0.0.0:8485\",\"yarn.resourcemanager.address.rm2\":\"172.16.22.103:8032\",\"yarn.scheduler.capacity.root.queues\":\"default\",\"yarn.scheduler.maximum-allocation-vcores\":\"4\",\"dfs.namenode.rpc-address.ns1.nn2\":\"172.16.22.103:9000\",\"ipc.client.connection.maxidletime\":\"10000\",\"dfs.namenode.rpc-address.ns1.nn1\":\"172.16.21.107:9000\",\"yarn.scheduler.capacity.maximum-applications\":\"10000\",\"yarn.resourcemanager.cluster-id\":\"yarn-rm-cluster\",\"ha.health-monitor.sleep-after-disconnect.ms\":\"1000\",\"yarn.nodemanager.aux-services\":\"mapreduce_shuffle\",\"hadoop.util.hash.type\":\"murmur\",\"yarn.webapp.api-service.enable\":\"false\",\"dfs.hosts.exclude\":\"null\",\"dfs.namenode.replication.min\":\"1\",\"yarn.nodemanager.container-manager.thread-count\":\"20\",\"dfs.datanode.directoryscan.threads\":\"1\",\"dfs.namenode.fs-limits.min-block-size\":\"1048576\",\"dfs.datanode.directoryscan.interval\":\"21600\",\"net.topology.script.number.args\":\"100\",\"hadoop.http.authentication.token.validity\":\"36000\",\"ha.failover-controller.graceful-fence.rpc-timeout.ms\":\"5000\",\"yarn.resourcemanager.nm.liveness-monitor.interval-ms\":\"1000\",\"dfs.namenode.datanode.registration.ip-hostname-check\":\"false\",\"yarn.scheduler.capacity.root.default.maximum-capacity\":\"100\",\"mapreduce.reduce.speculative\":\"false\",\"yarn.nodemanager.localizer.cache.cleanup.interval-ms\":\"3600000\",\"yarn.scheduler.capacity.maximum-am-resource-percent\":\"0.1\",\"mapreduce.job.maps\":\"1\",\"dfs.client.file-block-storage-locations.num-threads\":\"10\",\"mapreduce.jobhistory.webapp.spnego-principal\":\"HTTP/_HOST@TDH\",\"yarn.resourcemanager.scheduler.address.rm1\":\"172.16.21.107:8030\",\"yarn.resourcemanager.scheduler.address.rm2\":\"172.16.22.103:8030\",\"yarn.nodemanager.delete.debug-delay-sec\":\"600\",\"dfs.webhdfs.enabled\":\"FALSE\",\"yarn.log-aggregation.retain-seconds\":\"604800\",\"dfs.namenode.avoid.write.stale.datanode\":\"FALSE\",\"fs.trash.interval\":\"14400\",\"yarn.scheduler.minimum-allocation-vcores\":\"1\",\"dfs.namenode.num.extra.edits.retained\":\"1000000\",\"ipc.client.connect.max.retries.on.timeouts\":\"45\",\"dfs.datanode.data.dir\":\"file:/data/hadoop/hdfs/data\",\"yarn.scheduler.capacity.root.default.state\":\"RUNNING\",\"yarn.resourcemanager.resource-tracker.address.rm1\":\"172.16.21.107:8031\",\"yarn.resourcemanager.resource-tracker.address.rm2\":\"172.16.22.103:8031\",\"ha.health-monitor.connect-retry-interval.ms\":\"1000\",\"yarn.nodemanager.env-whitelist\":\"JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,YARN_HOME\",\"yarn.resourcemanager.container.liveness-monitor.interval-ms\":\"600000\",\"yarn.scheduler.capacity.resource-calculator\":\"org.apache.hadoop.yarn.util.resource.DominantResourceCalculator\",\"dfs.client-write-packet-size\":\"65536\",\"dfs.journalnode.edits.dir\":\"/data/hadoop/hdfs/journal\",\"dfs.client.block.write.retries\":\"3\",\"yarn.nodemanager.linux-container-executor.cgroups.hierarchy\":\"/hadoop-yarn\",\"ha.failover-controller.graceful-fence.connection.retries\":\"1\",\"yarn.resourcemanager.recovery.enabled\":\"true\",\"dfs.namenode.safemode.threshold-pct\":\"0.999f\",\"yarn.nodemanager.disk-health-checker.enable\":\"true\",\"yarn.nodemanager.disk-health-checker.interval-ms\":\"120000\",\"raid.distraid.max.files\":\"300\",\"yarn.resourcemanager.admin.address.rm1\":\"172.16.21.107:8033\",\"yarn.log.server.url\":\"http://172.16.23.238:19888/jobhistory/logs/\",\"yarn.resourcemanager.admin.address.rm2\":\"172.16.22.103:8033\",\"dfs.datanode.dns.nameserver\":\"default\",\"javax.jdo.option.ConnectionDriverName\":\"com.mysql.jdbc.Driver\",\"yarn.resourcemanager.resource-tracker.client.thread-count\":\"50\",\"mapreduce.shuffle.port\":\"13562\",\"dfs.namenode.edits.journal-plugin.qjournal\":\"org.apache.hadoop.hdfs.qjournal.client.QuorumJournalManager\",\"yarn.nodemanager.delete.thread-count\":\"4\",\"dfs.nameservices\":\"ns1\",\"dfs.safemode.threshold.pct\":\"0.5\",\"ipc.client.idlethreshold\":\"4000\",\"yarn.nodemanager.linux-container-executor.cgroups.mount-path\":\"/sys/fs/cgroup\",\"yarn.scheduler.capacity.root.maximum-capacity\":\"100\",\"yarn.acl.enable\":\"FALSE\",\"dfs.client.failover.connection.retries.on.timeouts\":\"0\",\"hadoop.http.authentication.simple.anonymous.allowed\":\"true\",\"hadoop.security.authorization\":\"true\",\"hive.metastore.warehouse.dir\":\"/dtInsight/hive/warehouse\",\"yarn.am.liveness-monitor.expiry-interval-ms\":\"600000\",\"yarn.nodemanager.linux-container-executor.resources-handler.class\":\"org.apache.hadoop.yarn.server.nodemanager.util.CgroupsLCEResourcesHandler\",\"raidnode.files.fix.per.job\":\"500\",\"yarn.resourcemanager.client.thread-count\":\"50\",\"dfs.image.compression.codec\":\"org.apache.hadoop.io.compress.DefaultCodec\",\"hadoop.security.authentication\":\"simple\",\"mapreduce.job.reduce.slowstart.completedmaps\":\"1\",\"hive.metastore.uris\":\"thrift://172-16-23-238:9083\",\"hive.exec.dynamic.partition.mode\":\"nonstrict\",\"yarn.resourcemanager.max-completed-applications\":\"1000\",\"yarn.resourcemanager.ha.automatic-failover.enabled\":\"true\",\"yarn.nodemanager.linux-container-executor.cgroups.mount\":\"false\",\"yarn.log-aggregation-enable\":\"true\",\"hadoop.proxyuser.admin.hosts\":\"*\",\"yarn.resourcemanager.store.class\":\"org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore\",\"yarn.app.mapreduce.am.job.task.listener.thread-count\":\"30\",\"hive.cluster.delegation.token.store.class\":\"org.apache.hadoop.hive.thrift.MemoryTokenStore\",\"dfs.namenode.support.allow.format\":\"true\",\"yarn.nodemanager.log.retain-seconds\":\"10800\",\"dfs.httpfs.oauth2.enabled\":\"true\",\"yarn.resourcemanager.ha.rm-ids\":\"rm1,rm2\",\"dfs.stream-buffer-size\":\"4096\",\"hadoop.proxyuser.admin.groups\":\"*\",\"yarn.nodemanager.container-executor.class\":\"org.apache.hadoop.yarn.server.nodemanager.LinuxContainerExecutor\",\"yarn.resourcemanager.scheduler.client.thread-count\":\"50\",\"dfs.bytes-per-checksum\":\"512\",\"dfs.datanode.max.transfer.threads\":\"4096\",\"raid.distraid.max.jobs\":\"10\",\"ipc.maximum.data.length\":\"134217728\",\"httpfs.hadoop.config.dir\":\"/etc/hdfs1/conf\",\"httpfs.proxyuser.root.hosts\":\"*\",\"yarn.app.mapreduce.am.job.client.port-range\":\"50100-50200\",\"httpfs.proxyuser.hdfs.groups\":\"*\",\"ha.failover-controller.new-active.rpc-timeout.ms\":\"60000\",\"hadoop.http.authentication.type\":\"simple\",\"httpfs.hadoop.authentication.kerberos.principal\":\"httpfs/tdh-621-node01@TDH\",\"yarn.scheduler.capacity.root.state\":\"RUNNING\",\"yarn.scheduler.minimum-allocation-mb\":\"512\",\"yarn.scheduler.capacity.root.user-limit-factor\":\"1\",\"httpfs.proxyuser.hbase.hosts\":\"*\",\"dfs.permissions.superusergroup\":\"supergroup\",\"io.seqfile.compress.blocksize\":\"1000000\",\"dfs.namenode.fs-limits.max-directory-items\":\"1048576\",\"httpfs.authentication.kerberos.keytab\":\"/etc/hdfs1/conf/hdfs.keytab\",\"yarn.resourcemanager.amliveliness-monitor.interval-ms\":\"1000\",\"yarn.nodemanager.pmem-check-enabled\":\"true\",\"httpfs.proxyuser.root.groups\":\"*\",\"yarn.nodemanager.remote-app-log-dir\":\"/tmp/logs\",\"dfs.blockreport.initialDelay\":\"0\",\"yarn.scheduler.maximum-allocation-mb\":\"12288\",\"dfs.namenode.safemode.extension\":\"30000\",\"yarn.nodemanager.vmem-check-enabled\":\"false\",\"httpfs.proxyuser.hue.hosts\":\"*\",\"yarn.nodemanager.resource.percentage-physical-cpu-limit\":\"80\",\"fs.permissions.umask-mode\":\"022\",\"yarn.app.mapreduce.am.command-opts\":\"-agentpath:/usr/lib/hadoop/bin/libagent.so -Xmx2048m\",\"ha.health-monitor.rpc-timeout.ms\":\"45000\",\"hive.exec.dynamic.partition\":\"true\",\"dfs.datanode.http.address\":\"0.0.0.0:60075\",\"yarn.nodemanager.linux-container-executor.group\":\"admin\",\"dfs.namenode.fs-limits.max-blocks-per-file\":\"1048576\",\"yarn.client.failover-proxy-provider\":\"org.apache.hadoop.yarn.client.ConfiguredRMFailoverProxyProvider\",\"yarn.scheduler.capacity.root.maximum-applications\":\"10000\",\"dfs.client.block.write.replace-datanode-on-failure.enable\":\"TRUE\",\"yarn.nodemanager.remote-app-log-dir-suffix\":\"logs\",\"mapreduce.jobhistory.principal\":\"mapred/_HOST@TDH\",\"net.topology.node.switch.mapping.impl\":\"org.apache.hadoop.net.ScriptBasedMapping\",\"yarn.scheduler.capacity.root.default.acl_administer_queue\":\"*\",\"fs.df.interval\":\"60000\",\"yarn.nodemanager.resource.count-logical-processors-as-cores\":\"true\",\"httpfs.hadoop.authentication.type\":\"kerberos\",\"ha.zookeeper.parent-znode\":\"/hadoop-ha\",\"yarn.nodemanager.resource.cpu-vcores\":\"8\",\"yarn.log-aggregation.retain-check-interval-seconds\":\"604800\",\"dfs.https.enable\":\"FALSE\",\"yarn.scheduler.capacity.root.default.user-limit-factor\":\"1\",\"dfs.permissions.enabled\":\"TRUE\",\"dfs.blockreport.split.threshold\":\"500000\",\"dfs.datanode.balance.bandwidthPerSec\":\"1048576\",\"ha.zookeeper.quorum\":\"172.16.21.107:2181,172.16.22.103:2181,172.16.23.238:2181\",\"hadoop.http.filter.initializers\":\"org.apache.hadoop.http.lib.StaticUserWebFilter\",\"ipc.server.read.threadpool.size\":\"1\",\"dfs.namenode.stale.datanode.interval\":\"60000\",\"yarn.resourcemanager.webapp.address.rm2\":\"172.16.22.103:18088\",\"yarn.resourcemanager.webapp.address.rm1\":\"172.16.21.107:18088\",\"yarn.app.mapreduce.client-am.ipc.max-retries\":\"3\",\"dfs.default.chunk.view.size\":\"32768\",\"typeName\":\"yarn2-hdfs2-hadoop2\",\"dfs.client.failover.proxy.provider.ns1\":\"org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider\",\"yarn.nodemanager.linux-container-executor.cgroups.strict-resource-usage\":\"false\",\"yarn.resourcemanager.am.max-retries\":\"1\",\"httpfs.proxyuser.hbase.groups\":\"*\",\"dfs.namenode.handler.count\":\"64\",\"mapreduce.jobhistory.address\":\"tdh-621-node01:10020\",\"dfs.replication.max\":\"512\",\"io.bytes.per.checksum\":\"512\",\"dfs.namenode.name.dir\":\"file:/data/hadoop/hdfs/name\",\"yarn.app.mapreduce.client.max-retries\":\"3\",\"yarn.nodemanager.resource.memory-mb\":\"12288\",\"yarn.nodemanager.disk-health-checker.min-healthy-disks\":\"0.25\",\"dfs.datanode.failed.volumes.tolerated\":\"0\",\"ipc.client.kill.max\":\"10\",\"ipc.server.listen.queue.size\":\"128\",\"mapreduce.framework.name\":\"yarn\",\"yarn.nodemanager.localizer.cache.target-size-mb\":\"10240\",\"yarn.resourcemanager.admin.client.thread-count\":\"1\",\"mapreduce.job.max.split.locations\":\"500\",\"yarn.resourcemanager.scheduler.class\":\"org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler\",\"dfs.blocksize\":\"134217728\",\"dfs.datanode.address\":\"0.0.0.0:50010\",\"security.job.submission.protocol.acl\":\"admin\",\"ha.failover-controller.cli-check.rpc-timeout.ms\":\"20000\",\"ipc.client.connect.max.retries\":\"10\",\"ha.zookeeper.acl\":\"world:anyone:rwcda\",\"dfs.namenode.write.stale.datanode.ratio\":\"0.5f\",\"dfs.httpfs.cas.enabled\":\"false\",\"httpfs.proxyuser.hue.groups\":\"*\",\"hadoop.tmp.dir\":\"/data/hadoop_admin\",\"dfs.datanode.handler.count\":\"10\",\"yarn.scheduler.capacity.root.capacity\":\"100\",\"dfs.client.failover.max.attempts\":\"15\",\"yarn.resourcemanager.zk-state-store.address\":\"172.16.21.107:2181,172.16.22.103:2181,172.16.23.238:2181\",\"mapreduce.map.speculative\":\"true\",\"dfs.hosts\":\"null\",\"mapreduce.jobhistory.keytab\":\"/etc/yarn1/conf/yarn.keytab\",\"yarn.resourcemanager.ha.automatic-failover.zk-base-path\":\"/yarn-leader-election\",\"httpfs.proxyuser.hdfs.hosts\":\"*\",\"yarn.scheduler.capacity.root.acl_administer_queue\":\"*\",\"yarn.resourcemanager.ha.enabled\":\"true\",\"yarn.app.mapreduce.am.scheduler.heartbeat.interval-ms\":\"1000\",\"fs.trash.checkpoint.interval\":\"60\",\"dfs.journalnode.http-address\":\"0.0.0.0:18480\",\"yarn.scheduler.capacity.root.default.acl_submit_applications\":\"*\",\"yarn.app.mapreduce.am.staging-dir\":\"/yarn1/user\",\"yarn.nm.liveness-monitor.expiry-interval-ms\":\"600000\",\"ha.health-monitor.check-interval.ms\":\"1000\",\"dfs.blockreport.intervalMsec\":\"21600000\",\"hive.metastore.schema.verification\":\"false\",\"mapreduce.job.hdfs-servers\":\"${fs.defaultFS}\",\"javax.jdo.option.ConnectionPassword\":\"DT@Stack#123\",\"io.native.lib.available\":\"TRUE\",\"mapreduce.jobhistory.webapp.spnego-keytab-file\":\"/etc/yarn1/conf/yarn.keytab\",\"dfs.image.compress\":\"FALSE\",\"yarn.nodemanager.webapp.address\":\"0.0.0.0:18042\",\"yarn.nodemanager.aux-services.mapreduce_shuffle.class\":\"org.apache.hadoop.mapred.ShuffleHandler\",\"dfs.datanode.dns.interface\":\"default\",\"dfs.client.failover.connection.retries\":\"0\",\"fs.defaultFS\":\"hdfs://ns1\",\"yarn.nodemanager.disk-health-checker.max-disk-utilization-per-disk-percentage\":\"90\",\"dfs.namenode.fs-limits.max-component-length\":\"0\",\"dfs.ha.fencing.methods\":\"sshfence\",\"dfs.datanode.du.reserved\":\"20971520\",\"javax.jdo.option.ConnectionURL\":\"jdbc:mysql://172.16.22.103:3306/metastore?createDatabaseIfNotExist=true\",\"dfs.datanode.ipc.address\":\"0.0.0.0:50020\",\"dfs.client.block.write.replace-datanode-on-failure.policy\":\"DEFAULT\",\"yarn.nodemanager.disk-health-checker.min-free-space-per-disk-mb\":\"10240\",\"dfs.namenode.shared.edits.dir\":\"qjournal://172.16.21.107:8485;172.16.22.103:8485;172.16.23.238:8485/namenode-ha-data\",\"javax.jdo.option.ConnectionUserName\":\"drpeco\",\"mapreduce.jobhistory.webapp.address\":\"tdh-621-node01:19888\",\"dfs.namenode.name.dir.restore\":\"FALSE\",\"dfs.heartbeat.interval\":\"3\",\"yarn.scheduler.capacity.root.default.capacity\":\"100\",\"ha.zookeeper.session-timeout.ms\":\"5000\",\"dfs.namenode.http-address.ns1.nn2\":\"172.16.22.103:60070\",\"dfs.namenode.http-address.ns1.nn1\":\"172.16.21.107:60070\",\"httpfs.authentication.type\":\"kerberos\",\"yarn.nodemanager.vmem-pmem-ratio\":\"4.1\",\"yarn.scheduler.capacity.node-locality-delay\":\"-1\",\"yarn.scheduler.capacity.root.maximum-am-resource-percent\":\"0.1\",\"hive.exec.scratchdir\":\"/dtInsight/hive/warehouse\",\"hadoop.http.authentication.signature.secret.file\":\"/data/hadoop_base/etc/hadoop/hadoop-http-auth-signature-secret\",\"datanucleus.schema.autoCreateAll\":\"true\",\"yarn.nodemanager.log-aggregation.compression-type\":\"none\",\"dfs.ha.automatic-failover.enabled\":\"true\"},\"state.backend.incremental\":\"true\",\"metrics.reporter.promgateway.deleteOnShutdown\":\"true\",\"high-availability.zookeeper.quorum\":\"172.16.23.25\",\"yarn.application-attempt-failures-validity-interval\":\"3600000\",\"state.backend\":\"RocksDB\",\"akka.tcp.timeout\":\"60 s\",\"remoteFlinkxDistDir\":\"/data/112_flinkplugin/flinkxplugins\",\"prometheusPort\":\"9090\",\"metrics.reporter.promgateway.host\":\"172.16.23.25\",\"state.checkpoints.num-retained\":\"11\",\"flinkxDistDir\":\"/data/112_flinkplugin/flinkxplugins\",\"hiveConf\":{\"maxJobPoolSize\":\"\",\"password\":\"\",\"minJobPoolSize\":\"\",\"jdbcUrl\":\"jdbc:hive2://172.16.85.248:10004/%s\",\"queue\":\"\",\"username\":\"root\"},\"typeName\":\"yarn2-hdfs2-flink112\",\"monitorAcceptedApp\":\"false\",\"state.savepoints.dir\":\"hdfs://ns1/dtInsight/flink112/savepoints\",\"sftpConf\":{\"maxWaitMillis\":\"3600000\",\"minIdle\":\"16\",\"auth\":\"1\",\"isUsePool\":\"false\",\"timeout\":\"0\",\"path\":\"/data/sftp\",\"password\":\"dt@sz.com\",\"maxIdle\":\"16\",\"port\":\"22\",\"maxTotal\":\"16\",\"host\":\"172.16.100.251\",\"fileTimeout\":\"300000\",\"username\":\"root\"},\"clusterMode\":\"perjob\",\"remoteFlinkLibDir\":\"/data/112_flinkplugin/lib/\",\"metrics.reporter.promgateway.randomJobNameSuffix\":\"true\",\"yarn.application-attempts\":\"3\",\"taskmanager.numberOfTaskSlots\":\"1\",\"akka.ask.timeout\":\"60 s\",\"jobmanager.archive.fs.dir\":\"hdfs://ns1/dtInsight/flink112/completed-jobs\",\"restart-strategy.failure-rate.delay\":\"1s\",\"classloader.resolve-order\":\"child-first\",\"yarnConf\":{\"yarn.resourcemanager.zk-address\":\"172.16.21.107:2181,172.16.22.103:2181,172.16.23.238:2181\",\"yarn.scheduler.capacity.root.acl_submit_applications\":\"*\",\"mapred.child.java.opts\":\"-agentpath:/usr/lib/hadoop/bin/libagent.so -Xmx2048m\",\"dfs.replication\":\"3\",\"yarn.admin.acl\":\"*\",\"dfs.ha.fencing.ssh.private-key-files\":\"~/.ssh/id_rsa\",\"yarn.app.mapreduce.am.job.committer.cancel-timeout\":\"60000\",\"httpfs.hadoop.authentication.kerberos.keytab\":\"/etc/hdfs1/conf/hdfs.keytab\",\"dfs.ha.namenodes.ns1\":\"nn1,nn2\",\"yarn.resourcemanager.address.rm1\":\"172.16.21.107:8032\",\"httpfs.authentication.kerberos.principal\":\"HTTP/tdh-621-node01@TDH\",\"dfs.namenode.avoid.read.stale.datanode\":\"FALSE\",\"dfs.journalnode.rpc-address\":\"0.0.0.0:8485\",\"yarn.resourcemanager.address.rm2\":\"172.16.22.103:8032\",\"yarn.scheduler.capacity.root.queues\":\"default\",\"yarn.scheduler.maximum-allocation-vcores\":\"4\",\"dfs.namenode.rpc-address.ns1.nn2\":\"172.16.22.103:9000\",\"ipc.client.connection.maxidletime\":\"10000\",\"dfs.namenode.rpc-address.ns1.nn1\":\"172.16.21.107:9000\",\"yarn.scheduler.capacity.maximum-applications\":\"10000\",\"yarn.resourcemanager.cluster-id\":\"yarn-rm-cluster\",\"ha.health-monitor.sleep-after-disconnect.ms\":\"1000\",\"yarn.nodemanager.aux-services\":\"mapreduce_shuffle\",\"hadoop.util.hash.type\":\"murmur\",\"yarn.webapp.api-service.enable\":\"false\",\"dfs.hosts.exclude\":\"null\",\"dfs.namenode.replication.min\":\"1\",\"yarn.nodemanager.container-manager.thread-count\":\"20\",\"dfs.datanode.directoryscan.threads\":\"1\",\"dfs.namenode.fs-limits.min-block-size\":\"1048576\",\"dfs.datanode.directoryscan.interval\":\"21600\",\"net.topology.script.number.args\":\"100\",\"hadoop.http.authentication.token.validity\":\"36000\",\"ha.failover-controller.graceful-fence.rpc-timeout.ms\":\"5000\",\"yarn.resourcemanager.nm.liveness-monitor.interval-ms\":\"1000\",\"dfs.namenode.datanode.registration.ip-hostname-check\":\"false\",\"yarn.scheduler.capacity.root.default.maximum-capacity\":\"100\",\"mapreduce.reduce.speculative\":\"false\",\"yarn.nodemanager.localizer.cache.cleanup.interval-ms\":\"3600000\",\"yarn.scheduler.capacity.maximum-am-resource-percent\":\"0.1\",\"mapreduce.job.maps\":\"1\",\"dfs.client.file-block-storage-locations.num-threads\":\"10\",\"mapreduce.jobhistory.webapp.spnego-principal\":\"HTTP/_HOST@TDH\",\"yarn.resourcemanager.scheduler.address.rm1\":\"172.16.21.107:8030\",\"yarn.resourcemanager.scheduler.address.rm2\":\"172.16.22.103:8030\",\"yarn.nodemanager.delete.debug-delay-sec\":\"600\",\"dfs.webhdfs.enabled\":\"FALSE\",\"yarn.log-aggregation.retain-seconds\":\"604800\",\"dfs.namenode.avoid.write.stale.datanode\":\"FALSE\",\"fs.trash.interval\":\"14400\",\"yarn.scheduler.minimum-allocation-vcores\":\"1\",\"dfs.namenode.num.extra.edits.retained\":\"1000000\",\"ipc.client.connect.max.retries.on.timeouts\":\"45\",\"dfs.datanode.data.dir\":\"file:/data/hadoop/hdfs/data\",\"yarn.scheduler.capacity.root.default.state\":\"RUNNING\",\"yarn.resourcemanager.resource-tracker.address.rm1\":\"172.16.21.107:8031\",\"yarn.resourcemanager.resource-tracker.address.rm2\":\"172.16.22.103:8031\",\"ha.health-monitor.connect-retry-interval.ms\":\"1000\",\"yarn.nodemanager.env-whitelist\":\"JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,YARN_HOME\",\"yarn.resourcemanager.container.liveness-monitor.interval-ms\":\"600000\",\"yarn.scheduler.capacity.resource-calculator\":\"org.apache.hadoop.yarn.util.resource.DominantResourceCalculator\",\"dfs.client-write-packet-size\":\"65536\",\"dfs.journalnode.edits.dir\":\"/data/hadoop/hdfs/journal\",\"dfs.client.block.write.retries\":\"3\",\"yarn.nodemanager.linux-container-executor.cgroups.hierarchy\":\"/hadoop-yarn\",\"ha.failover-controller.graceful-fence.connection.retries\":\"1\",\"yarn.resourcemanager.recovery.enabled\":\"true\",\"dfs.namenode.safemode.threshold-pct\":\"0.999f\",\"yarn.nodemanager.disk-health-checker.enable\":\"true\",\"yarn.nodemanager.disk-health-checker.interval-ms\":\"120000\",\"raid.distraid.max.files\":\"300\",\"yarn.resourcemanager.admin.address.rm1\":\"172.16.21.107:8033\",\"yarn.log.server.url\":\"http://172.16.23.238:19888/jobhistory/logs/\",\"yarn.resourcemanager.admin.address.rm2\":\"172.16.22.103:8033\",\"dfs.datanode.dns.nameserver\":\"default\",\"javax.jdo.option.ConnectionDriverName\":\"com.mysql.jdbc.Driver\",\"yarn.resourcemanager.resource-tracker.client.thread-count\":\"50\",\"mapreduce.shuffle.port\":\"13562\",\"dfs.namenode.edits.journal-plugin.qjournal\":\"org.apache.hadoop.hdfs.qjournal.client.QuorumJournalManager\",\"yarn.nodemanager.delete.thread-count\":\"4\",\"dfs.nameservices\":\"ns1\",\"dfs.safemode.threshold.pct\":\"0.5\",\"ipc.client.idlethreshold\":\"4000\",\"yarn.nodemanager.linux-container-executor.cgroups.mount-path\":\"/sys/fs/cgroup\",\"yarn.scheduler.capacity.root.maximum-capacity\":\"100\",\"yarn.acl.enable\":\"FALSE\",\"dfs.client.failover.connection.retries.on.timeouts\":\"0\",\"hadoop.http.authentication.simple.anonymous.allowed\":\"true\",\"hadoop.security.authorization\":\"true\",\"hive.metastore.warehouse.dir\":\"/dtInsight/hive/warehouse\",\"yarn.am.liveness-monitor.expiry-interval-ms\":\"600000\",\"yarn.nodemanager.linux-container-executor.resources-handler.class\":\"org.apache.hadoop.yarn.server.nodemanager.util.CgroupsLCEResourcesHandler\",\"raidnode.files.fix.per.job\":\"500\",\"yarn.resourcemanager.client.thread-count\":\"50\",\"dfs.image.compression.codec\":\"org.apache.hadoop.io.compress.DefaultCodec\",\"hadoop.security.authentication\":\"simple\",\"mapreduce.job.reduce.slowstart.completedmaps\":\"1\",\"hive.metastore.uris\":\"thrift://172-16-23-238:9083\",\"hive.exec.dynamic.partition.mode\":\"nonstrict\",\"yarn.resourcemanager.max-completed-applications\":\"1000\",\"yarn.resourcemanager.ha.automatic-failover.enabled\":\"true\",\"yarn.nodemanager.linux-container-executor.cgroups.mount\":\"false\",\"yarn.log-aggregation-enable\":\"true\",\"hadoop.proxyuser.admin.hosts\":\"*\",\"yarn.resourcemanager.store.class\":\"org.apache.hadoop.yarn.server.resourcemanager.recovery.ZKRMStateStore\",\"yarn.app.mapreduce.am.job.task.listener.thread-count\":\"30\",\"hive.cluster.delegation.token.store.class\":\"org.apache.hadoop.hive.thrift.MemoryTokenStore\",\"dfs.namenode.support.allow.format\":\"true\",\"yarn.nodemanager.log.retain-seconds\":\"10800\",\"dfs.httpfs.oauth2.enabled\":\"true\",\"yarn.resourcemanager.ha.rm-ids\":\"rm1,rm2\",\"dfs.stream-buffer-size\":\"4096\",\"hadoop.proxyuser.admin.groups\":\"*\",\"yarn.nodemanager.container-executor.class\":\"org.apache.hadoop.yarn.server.nodemanager.LinuxContainerExecutor\",\"yarn.resourcemanager.scheduler.client.thread-count\":\"50\",\"dfs.bytes-per-checksum\":\"512\",\"dfs.datanode.max.transfer.threads\":\"4096\",\"raid.distraid.max.jobs\":\"10\",\"ipc.maximum.data.length\":\"134217728\",\"httpfs.hadoop.config.dir\":\"/etc/hdfs1/conf\",\"httpfs.proxyuser.root.hosts\":\"*\",\"yarn.app.mapreduce.am.job.client.port-range\":\"50100-50200\",\"httpfs.proxyuser.hdfs.groups\":\"*\",\"ha.failover-controller.new-active.rpc-timeout.ms\":\"60000\",\"hadoop.http.authentication.type\":\"simple\",\"httpfs.hadoop.authentication.kerberos.principal\":\"httpfs/tdh-621-node01@TDH\",\"yarn.scheduler.capacity.root.state\":\"RUNNING\",\"yarn.scheduler.minimum-allocation-mb\":\"512\",\"yarn.scheduler.capacity.root.user-limit-factor\":\"1\",\"httpfs.proxyuser.hbase.hosts\":\"*\",\"dfs.permissions.superusergroup\":\"supergroup\",\"io.seqfile.compress.blocksize\":\"1000000\",\"dfs.namenode.fs-limits.max-directory-items\":\"1048576\",\"httpfs.authentication.kerberos.keytab\":\"/etc/hdfs1/conf/hdfs.keytab\",\"yarn.resourcemanager.amliveliness-monitor.interval-ms\":\"1000\",\"yarn.nodemanager.pmem-check-enabled\":\"true\",\"httpfs.proxyuser.root.groups\":\"*\",\"yarn.nodemanager.remote-app-log-dir\":\"/tmp/logs\",\"dfs.blockreport.initialDelay\":\"0\",\"yarn.scheduler.maximum-allocation-mb\":\"12288\",\"dfs.namenode.safemode.extension\":\"30000\",\"yarn.nodemanager.vmem-check-enabled\":\"false\",\"httpfs.proxyuser.hue.hosts\":\"*\",\"yarn.nodemanager.resource.percentage-physical-cpu-limit\":\"80\",\"fs.permissions.umask-mode\":\"022\",\"yarn.app.mapreduce.am.command-opts\":\"-agentpath:/usr/lib/hadoop/bin/libagent.so -Xmx2048m\",\"ha.health-monitor.rpc-timeout.ms\":\"45000\",\"hive.exec.dynamic.partition\":\"true\",\"dfs.datanode.http.address\":\"0.0.0.0:60075\",\"yarn.nodemanager.linux-container-executor.group\":\"admin\",\"dfs.namenode.fs-limits.max-blocks-per-file\":\"1048576\",\"yarn.client.failover-proxy-provider\":\"org.apache.hadoop.yarn.client.ConfiguredRMFailoverProxyProvider\",\"yarn.scheduler.capacity.root.maximum-applications\":\"10000\",\"dfs.client.block.write.replace-datanode-on-failure.enable\":\"TRUE\",\"yarn.nodemanager.remote-app-log-dir-suffix\":\"logs\",\"mapreduce.jobhistory.principal\":\"mapred/_HOST@TDH\",\"net.topology.node.switch.mapping.impl\":\"org.apache.hadoop.net.ScriptBasedMapping\",\"yarn.scheduler.capacity.root.default.acl_administer_queue\":\"*\",\"fs.df.interval\":\"60000\",\"yarn.resourcemanager.scheduler.queue.is-full-path\":\"true\",\"yarn.nodemanager.resource.count-logical-processors-as-cores\":\"true\",\"httpfs.hadoop.authentication.type\":\"kerberos\",\"ha.zookeeper.parent-znode\":\"/hadoop-ha\",\"yarn.nodemanager.resource.cpu-vcores\":\"8\",\"yarn.log-aggregation.retain-check-interval-seconds\":\"604800\",\"dfs.https.enable\":\"FALSE\",\"yarn.scheduler.capacity.root.default.user-limit-factor\":\"1\",\"dfs.permissions.enabled\":\"TRUE\",\"dfs.blockreport.split.threshold\":\"500000\",\"dfs.datanode.balance.bandwidthPerSec\":\"1048576\",\"ha.zookeeper.quorum\":\"172.16.21.107:2181,172.16.22.103:2181,172.16.23.238:2181\",\"hadoop.http.filter.initializers\":\"org.apache.hadoop.http.lib.StaticUserWebFilter\",\"ipc.server.read.threadpool.size\":\"1\",\"dfs.namenode.stale.datanode.interval\":\"60000\",\"yarn.resourcemanager.webapp.address.rm2\":\"172.16.22.103:18088\",\"yarn.resourcemanager.webapp.address.rm1\":\"172.16.21.107:18088\",\"yarn.app.mapreduce.client-am.ipc.max-retries\":\"3\",\"dfs.default.chunk.view.size\":\"32768\",\"dfs.client.failover.proxy.provider.ns1\":\"org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider\",\"yarn.nodemanager.linux-container-executor.cgroups.strict-resource-usage\":\"false\",\"yarn.resourcemanager.am.max-retries\":\"1\",\"httpfs.proxyuser.hbase.groups\":\"*\",\"dfs.namenode.handler.count\":\"64\",\"mapreduce.jobhistory.address\":\"tdh-621-node01:10020\",\"dfs.replication.max\":\"512\",\"io.bytes.per.checksum\":\"512\",\"dfs.namenode.name.dir\":\"file:/data/hadoop/hdfs/name\",\"yarn.app.mapreduce.client.max-retries\":\"3\",\"yarn.nodemanager.resource.memory-mb\":\"12288\",\"yarn.nodemanager.disk-health-checker.min-healthy-disks\":\"0.25\",\"dfs.datanode.failed.volumes.tolerated\":\"0\",\"ipc.client.kill.max\":\"10\",\"ipc.server.listen.queue.size\":\"128\",\"mapreduce.framework.name\":\"yarn\",\"yarn.nodemanager.localizer.cache.target-size-mb\":\"10240\",\"yarn.resourcemanager.admin.client.thread-count\":\"1\",\"mapreduce.job.max.split.locations\":\"500\",\"yarn.resourcemanager.scheduler.class\":\"org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler\",\"dfs.blocksize\":\"134217728\",\"dfs.datanode.address\":\"0.0.0.0:50010\",\"security.job.submission.protocol.acl\":\"admin\",\"ha.failover-controller.cli-check.rpc-timeout.ms\":\"20000\",\"ipc.client.connect.max.retries\":\"10\",\"ha.zookeeper.acl\":\"world:anyone:rwcda\",\"dfs.namenode.write.stale.datanode.ratio\":\"0.5f\",\"dfs.httpfs.cas.enabled\":\"false\",\"httpfs.proxyuser.hue.groups\":\"*\",\"hadoop.tmp.dir\":\"/data/hadoop_admin\",\"dfs.datanode.handler.count\":\"10\",\"yarn.scheduler.capacity.root.capacity\":\"100\",\"dfs.client.failover.max.attempts\":\"15\",\"yarn.resourcemanager.zk-state-store.address\":\"172.16.21.107:2181,172.16.22.103:2181,172.16.23.238:2181\",\"mapreduce.map.speculative\":\"true\",\"dfs.hosts\":\"null\",\"mapreduce.jobhistory.keytab\":\"/etc/yarn1/conf/yarn.keytab\",\"yarn.resourcemanager.ha.automatic-failover.zk-base-path\":\"/yarn-leader-election\",\"httpfs.proxyuser.hdfs.hosts\":\"*\",\"yarn.scheduler.capacity.root.acl_administer_queue\":\"*\",\"yarn.resourcemanager.ha.enabled\":\"true\",\"yarn.app.mapreduce.am.scheduler.heartbeat.interval-ms\":\"1000\",\"fs.trash.checkpoint.interval\":\"60\",\"dfs.journalnode.http-address\":\"0.0.0.0:18480\",\"yarn.scheduler.capacity.root.default.acl_submit_applications\":\"*\",\"yarn.app.mapreduce.am.staging-dir\":\"/yarn1/user\",\"yarn.nm.liveness-monitor.expiry-interval-ms\":\"600000\",\"ha.health-monitor.check-interval.ms\":\"1000\",\"dfs.blockreport.intervalMsec\":\"21600000\",\"hive.metastore.schema.verification\":\"false\",\"mapreduce.job.hdfs-servers\":\"${fs.defaultFS}\",\"javax.jdo.option.ConnectionPassword\":\"DT@Stack#123\",\"io.native.lib.available\":\"TRUE\",\"mapreduce.jobhistory.webapp.spnego-keytab-file\":\"/etc/yarn1/conf/yarn.keytab\",\"dfs.image.compress\":\"FALSE\",\"yarn.nodemanager.webapp.address\":\"0.0.0.0:18042\",\"yarn.nodemanager.aux-services.mapreduce_shuffle.class\":\"org.apache.hadoop.mapred.ShuffleHandler\",\"dfs.datanode.dns.interface\":\"default\",\"dfs.client.failover.connection.retries\":\"0\",\"fs.defaultFS\":\"hdfs://ns1\",\"yarn.nodemanager.disk-health-checker.max-disk-utilization-per-disk-percentage\":\"90\",\"dfs.namenode.fs-limits.max-component-length\":\"0\",\"dfs.ha.fencing.methods\":\"sshfence\",\"dfs.datanode.du.reserved\":\"20971520\",\"javax.jdo.option.ConnectionURL\":\"jdbc:mysql://172.16.22.103:3306/metastore?createDatabaseIfNotExist=true\",\"dfs.datanode.ipc.address\":\"0.0.0.0:50020\",\"dfs.client.block.write.replace-datanode-on-failure.policy\":\"DEFAULT\",\"yarn.nodemanager.disk-health-checker.min-free-space-per-disk-mb\":\"10240\",\"dfs.namenode.shared.edits.dir\":\"qjournal://172.16.21.107:8485;172.16.22.103:8485;172.16.23.238:8485/namenode-ha-data\",\"javax.jdo.option.ConnectionUserName\":\"drpeco\",\"mapreduce.jobhistory.webapp.address\":\"tdh-621-node01:19888\",\"dfs.namenode.name.dir.restore\":\"FALSE\",\"dfs.heartbeat.interval\":\"3\",\"yarn.scheduler.capacity.root.default.capacity\":\"100\",\"ha.zookeeper.session-timeout.ms\":\"5000\",\"dfs.namenode.http-address.ns1.nn2\":\"172.16.22.103:60070\",\"dfs.namenode.http-address.ns1.nn1\":\"172.16.21.107:60070\",\"httpfs.authentication.type\":\"kerberos\",\"yarn.nodemanager.vmem-pmem-ratio\":\"4.1\",\"yarn.scheduler.capacity.node-locality-delay\":\"-1\",\"yarn.scheduler.capacity.root.maximum-am-resource-percent\":\"0.1\",\"hive.exec.scratchdir\":\"/dtInsight/hive/warehouse\",\"hadoop.http.authentication.signature.secret.file\":\"/data/hadoop_base/etc/hadoop/hadoop-http-auth-signature-secret\",\"datanucleus.schema.autoCreateAll\":\"true\",\"yarn.nodemanager.log-aggregation.compression-type\":\"none\",\"dfs.ha.automatic-failover.enabled\":\"true\"},\"jobmanager.memory.process.size\":\"1600m\",\"classloader.dtstack-cache\":\"true\",\"high-availability\":\"ZOOKEEPER\",\"md5zip\":\"\",\"namespace\":\"default\",\"restart-strategy\":\"failurerate\",\"queue\":\"default\",\"state.checkpoints.dir\":\"hdfs://ns1/dtInsight/flink112/checkpoints\"}");

        }
        if ("hive".equalsIgnoreCase(engineTypeStr)) {
            JSONObject jsonObject = new JSONObject();
            jsonObject.fluentPut("jdbcUrl", "jdbc:hive2://172.16.85.248:10004/%s");
            return jsonObject;
        }
        return null;
    }

    @MockInvoke(targetClass = ScheduleTaskShadeDao.class)
    String getExtInfoByTaskId( long taskId, Integer appType){
        return "{\"info\":\"{\\\"isFailRetry\\\":true,\\\"taskParamsToReplace\\\":\\\"[]\\\",\\\"sqlText\\\":\\\"begin select * from pg_tables limit 20; end; \\\",\\\"computeType\\\":1,\\\"engineType\\\":\\\"postgresql\\\",\\\"taskParams\\\":\\\"##任务优先级, 值越小，优先级越高，范围:1-1000\\\\r\\\\njob.priority=10\\\",\\\"maxRetryNum\\\":3,\\\"userId\\\":1,\\\"dirtyDataSourceType\\\":7,\\\"jdbcUrlParams\\\":{\\\"currentSchema\\\":\\\"dev\\\"},\\\"taskType\\\":0,\\\"multiEngineType\\\":2,\\\"name\\\":\\\"libra_test\\\",\\\"tenantId\\\":1,\\\"taskId\\\":3195}\"}";
    }

    @MockInvoke(targetClass = ScheduleJobService.class)
    public ScheduleJob getByJobId(String jobId, Integer isDeleted) {
        ScheduleJob scheduleJob = new ScheduleJob();
        scheduleJob.setTaskId(100L);
        return scheduleJob;
    }

}
